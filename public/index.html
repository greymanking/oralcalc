<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>口算训练</title>
  <style>
    body {
      background-color: beige;
    }

    li {
      cursor: pointer;
      font-size: 2em;
    }

    li.selected {
      color: blue;
    }

    li.unselected {
      color: black;
    }

    button {
      font-size: 2em;
      margin: 10px;
      padding: 0 20px;
    }

    #extraInfo {
      font-size: 1.5em;
    }

    #ansZone {
      font-size: 1.5em;
    }

    #title {
      font-size: 2em;
    }

    #perf {
      font-size: 1.5em;
      margin: 15px 0;
      color: blue;
      text-align: left;
    }

    #taskZone {
      margin: 0 auto;
      text-align: center;
      vertical-align: middle;
      max-width: 30em;
    }

    #questionZone {
      font-size: 10em;
      vertical-align: bottom;
    }

    #resZone {
      font-size: 6em;
    }

    #ansZone {
      cursor: pointer;
    }
  </style>
</head>

<script type="text/javascript">
  //alert(window.innerWidth);

  //***以下初始化数据***//
  var w1 = [
    "13-9", "19-8", "18-9", "12-7", "14-8",
    "17-8", "13-7", "15-8", "13-9", "16-9",
    "16-8", "15-7", "14-7", "13-8", "15-7",
    "11-9", "18-9", "13-9", "15-8", "17-8",
    "12-7", "13-9", "19-9", "16-7", "18-9",
    "14-8", "14-7", "14-8", "18-9", "12-7",
    "17-7", "12-7", "16-9", "12-9", "14-9",
    "16-9", "14-9", "15-7", "14-8", "12-8",
    "15-9", "16-9", "14-9", "13-7", "17-9",
    "18-9", "16-8", "11-9", "18-9", "14-7",
    "17-8", "13-7", "12-7", "16-7", "15-8",
    "13-7", "16-9", "14-8", "14-9", "15-9",
    "14-8", "15-9", "17-9", "13-8", "15-7",
    "12-9", "14-7", "18-9", "15-7", "18-8",
    "16-8", "13-9", "12-7", "16-8", "17-9",
    "19-9", "15-7", "18-9", "18-9", "14-8",
    "12-7", "11-8", "16-8", "14-9", "14-7",
    "14-8", "17-7", "11-7", "15-8", "15-8",
    "14-7", "17-8", "11-9", "12-7", "16-9",
    "16-8", "13-9", "19-9", "17-8", "11-8",
  ];

  var w2 = [
    "12-8", "18-9", "17-8", "14-7", "11-7",
    "14-7", "12-9", "16-7", "15-9", "14-9",
    "15-8", "14-8", "15-9", "11-8", "17-8",
    "19-9", "15-7", "14-8", "13-8", "18-8",
    "18-9", "19-8", "13-8", "14-7", "19-9",
    "14-7", "17-7", "12-7", "17-9", "16-9",
    "13-9", "15-9", "11-8", "16-9", "13-8",
    "12-8", "11-8", "18-9", "18-9", "12-7",
    "11-7", "13-7", "15-8", "15-7", "15-9",
    "16-8", "17-8", "12-7", "12-9", "18-9",
    "15-9", "16-9", "14-9", "15-7", "17-8",
    "17-8", "12-8", "15-7", "11-9", "16-9",
    "18-9", "11-7", "16-8", "13-8", "14-7",
    "16-7", "14-8", "19-9", "16-9", "12-9",
    "14-8", "15-7", "11-9", "14-8", "11-8",
    "13-7", "17-8", "18-8", "18-9", "13-8",
    "11-8", "11-9", "17-9", "17-8", "15-7",
    "15-9", "13-8", "13-8", "19-8", "19-8",
    "16-8", "16-9", "14-7", "15-7", "14-9",
    "18-9", "14-7", "15-9", "11-8", "17-8",
  ];

  var w3 = [
    "9+4", "19-8", "18-9", "4+5", "4+12",
    "8-4", "13+7", "9+0", "13-9", "16-9",
    "6+5", "15-9", "4+9", "8+7", "15-7",
    "11-9", "6+13", "13-6", "15-6", "7+8",
    "3+8", "13-9", "9+8", "6+3", "18-9",
    "14-8", "8+9", "4+8", "8+11", "2+8",
    "17+2", "18-7", "16-9", "12-9", "4+8",
    "16-9", "20-9", "15-7", "4+12", "12-9",
    "6+9", "16-9", "4+6", "13-9", "17-9",
    "18-9", "5+3", "11-9", "8+2", "4+13",
    "6+8", "13+3", "2+15", "6+12", "5+6",
    "8+6", "16-9", "14+3", "14-9", "15-9",
    "8+9", "17-9", "17-7", "13-3", "15-7",
    "12-9", "20-7", "18-9", "5+12", "8+2",
    "7+5", "9+8", "18-7", "20-4", "17-9",
    "19-9", "17-9", "18-9", "9-8", "7+8",
    "12-6", "10+3", "16-9", "14-9", "14-4",
    "6+7", "17-1", "8+4", "5+6", "15-9",
    "9+5", "9-3", "18-9", "12+3", "16-3",
    "16-8", "9+7", "19-9", "17-8", "9+4",
  ];

  var w4 = [
    "10+4", "12-9", "8-2", "11-9", "4+7",
    "17-9", "9-5", "16-6", "9-2", "12-9",
    "3+8", "16-9", "5+3", "5+6", "8+4",
    "17-8", "9-5", "14-9", "17-9", "19-9",
    "5+7", "18-9", "9-7", "5+3", "18-8",
    "16-9", "19-3", "13-9", "5+13", "1+9",
    "12+5", "15-9", "12+6", "9+2", "9-2",
    "19-9", "9+7", "16-9", "19-9", "12-9",
    "3+11", "17-9", "3+8", "15-9", "5+4",
    "17-9", "3+12", "9+3", "8+6", "8+12",
    "9+0", "9-6", "19-9", "5+13", "18-9",
    "3+15", "12+5", "5+2", "8-1", "15-8",
    "17-1", "15-9", "3+6", "15-9", "19-9",
    "9-2", "20-2", "15-7", "12+6", "3+7",
    "6+1", "7+6", "18-9", "19-6", "9+7",
    "14-9", "18-9", "12+2", "11-9", "9-3",
    "13-8", "15+2", "14-7", "9-4", "14-9",
    "14-0", "19-3", "9-2", "9-6", "17-8",
    "8+10", "14-9", "9+6", "12+4", "18-9",
    "16-9", "5+4", "18-9", "3+7", "8+5",
  ];

  var w5 = [
    "6+3", "11-7", "9-2", "9+3", "13-9",
    "14-9", "11-9", "16-5", "7-2", "12-8",
    "2+6", "3+4", "5+4", "5+2", "7+4",
    "15-8", "7-5", "13-9", "16-9", "19-9",
    "3+8", "18-9", "9-2", "5+2", "18-7",
    "15-9", "6+6", "11+8", "5+14", "0+9",
    "13+2", "16-9", "12+5", "9+2", "9-1",
    "17-9", "6+7", "17-9", "19-9", "11-8",
    "4+13", "17-8", "5+8", "14-9", "3+4",
    "18-9", "4+12", "9+0", "8+4", "5+0",
    "8+1", "13-9", "11-9", "16-9", "12-9",
    "3+16", "11+5", "7+2", "5-1", "0+4",
    "17-9", "15-9", "1+6", "14-3", "17-3",
    "9-3", "20-3", "16-7", "12+5", "12+7",
    "17-9", "7+6", "15-9", "18-9", "16-9",
    "9+4", "16-9", "12+3", "7-3", "9-2",
    "15-8", "15+3", "14-9", "9-3", "13-9",
    "14-14", "19-9", "9-4", "10-6", "17-8",
    "4+10", "9+4", "8+6", "12+3", "12-9",
    "15-9", "6+7", "18-7", "15-9", "8+0",
  ];

  var w6 = [
    "6+3", "11-7", "9-2", "9+3", "13-9",
    "14-9", "11-9", "16-5", "7-2", "12-8",
    "2+6", "3+4", "5+4", "5+2", "7+4",
    "15-8", "7-5", "13-9", "16-9", "19-9",
    "3+8", "18-9", "9-2", "5+2", "18-7",
    "15-9", "6+6", "11+8", "5+14", "0+9",
    "13+2", "16-9", "12+5", "9+2", "9-1",
    "17-9", "6+7", "17-9", "19-9", "11-8",
    "4+13", "17-8", "5+8", "14-9", "3+4",
    "18-9", "4+12", "9+0", "8+4", "5+0",
    "8+1", "13-9", "11-9", "16-9", "12-9",
    "3+16", "11+5", "7+2", "5-1", "0+4",
    "17-9", "15-9", "1+6", "14-3", "17-3",
    "9-3", "20-3", "16-7", "12+5", "12+7",
    "17-9", "7+6", "15-9", "18-9", "16-9",
    "9+4", "16-9", "12+3", "7-3", "9-2",
    "15-8", "15+3", "14-9", "9-3", "13-9",
    "14-14", "19-9", "9-4", "10-6", "17-8",
    "4+10", "9+4", "8+6", "12+3", "12-9",
    "15-9", "6+7", "18-7", "15-9", "8+0",
  ];

  var w7 = [
    "5+6", "19-8", "18-9", "12-9", "4+11",
    "11-9", "13+7", "9+0", "14-6", "14-9",
    "20-15", "17-6", "4+9", "8+0", "14-7",
    "7+12", "6+13", "15-7", "3+4", "6+7",
    "14+2", "19-9", "9+7", "6+3", "15-8",
    "12-10", "8+9", "3+8", "14-9", "17-9",
    "15-8", "18-7", "16-9", "7-3", "3+8",
    "13-9", "9+4", "9+4", "14-7", "5+4",
    "7+6", "16-9", "4+4", "8-5", "17-9",
    "12-9", "5+3", "9+10", "17-9", "4+13",
    "2+8", "13+4", "3+15", "1+12", "18-9",
    "13-9", "10-9", "11-9", "14-7", "2+4",
    "0+9", "18-9", "17-8", "3+4", "8-7",
    "12-8", "19-7", "12-9", "5+11", "8+1",
    "3+5", "9+2", "3+4", "15-9", "5-3",
    "14-9", "15-9", "12-7", "9-3", "7+4",
    "11-6", "9+3", "15-9", "13-9", "17-9",
    "16-9", "16-1", "8+1", "5+5", "15-8",
    "9+2", "9+2", "19-9", "4+1", "5-3",
    "17-8", "0+7", "14-8", "19-8", "16-9",
  ];

  var w8 = [
    "11-8", "19-9", "16-7", "3+5", "3+11",
    "20-5", "10+7", "18-9", "14-6", "14-9",
    "1+8", "15-6", "2+9", "17-9", "13-7",
    "10+5", "6+3", "14-7", "3+4", "6+2",
    "12-9", "12-9", "0+5", "15-9", "16-8",
    "7+8", "2+9", "2+6", "4+11", "1+4",
    "15-9", "18-9", "17-9", "6-6", "11-9",
    "13-1", "9+3", "3+5", "18-7", "5+3",
    "17-9", "17-8", "6+4", "14-9", "19-9",
    "15-5", "18-9", "9+8", "5+5", "4+12",
    "7+5", "14+1", "16-9", "2+9", "12-9",
    "19-13", "7+8", "5+9", "14-6", "1+4",
    "7+2", "13-9", "14-8", "14-9", "16-7",
    "12-9", "4+3", "11-9", "4+1", "5+1",
    "8-2", "18-7", "3+5", "12-7", "8-3",
    "14-8", "20-1", "13-7", "9-9", "7+1",
    "11-9", "3+16", "14-9", "11-9", "15-9",
    "1+5", "12+6", "5+1", "4+3", "14-8",
    "9+7", "14-9", "19-9", "3+3", "9-3",
    "16-9", "13+3", "13-9", "11-7", "2+5",
  ];

  var w9 = [
    "16-7", "16-7", "13-6", "15-7", "17-6",
    "13-6", "11-6", "17-7", "13-6", "13-7",
    "17-6", "15-7", "10-7", "19-7", "13-6",
    "15-7", "14-7", "13-6", "13-6", "11-6",
    "14-6", "12-6", "11-6", "13-7", "15-7",
    "11-7", "13-7", "20-6", "11-6", "18-7",
    "11-6", "16-6", "15-7", "7-6", "12-6",
    "13-7", "8-7", "13-6", "17-7", "11-7",
    "16-7", "17-6", "19-6", "12-6", "15-6",
    "14-6", "18-6", "15-7", "13-7", "11-7",
    "9-6", "13-7", "16-7", "16-6", "14-6",
    "19-7", "15-7", "18-6", "11-6", "17-6",
    "17-6", "12-7", "14-7", "13-7", "16-7",
    "12-7", "18-6", "12-6", "14-6", "12-6",
    "15-7", "17-7", "13-6", "12-7", "14-7",
    "13-6", "20-6", "14-7", "15-6", "8-6",
    "14-6", "11-6", "11-6", "12-6", "14-7",
    "16-7", "13-6", "15-6", "15-7", "13-6",
    "14-7", "14-7", "13-7", "8-6", "13-7",
    "13-6", "13-6", "16-7", "12-7", "12-6",
  ]

  var titles = [
    "寒假口算01（减9,8,7）", "寒假口算02（减9,8,7）",
    "寒假口算01（改）", "寒假口算02（改）",
    "寒假口算03（改）", "寒假口算04（改）",
    "寒假口算05（改）", "寒假口算06（改）",
    "寒假口算减7,6（一）",
  ]

  var allData = [w1, w2, w3, w4, w5, w6, w7, w8, w9];
</script>

<body>
  <div id="taskZone">
    <ul id="listZone">
    </ul>
    <div id="perfZone">
      <div id="title"></div>
      <div id="perf"></div>
    </div>
    <div id="extraInfo"></div>
    <div id="questionZone"></div>
    <div id="resZone"></div>
    <div id="btnZone">
      <button id="nextBtn">下一题</button>
      <button id="startBtn">出　发</button>
      <button id="repeatBtn">再一次</button>
      <button id="perfBtn">看成绩</button>
      <button id="backBtn">返　回</button>
    </div>
    <div id="ansZone">
    </div>
  </div>
</body>

<script type="text/javascript">
  document.body.style.fontSize = Math.min(16, Math.floor(window.innerWidth / 30)) + "px";

  //***以下初始化数据***//
  var questions = allData[0];
  var curTitle = titles[0];

  var PERFINFO = -2, READY = -1, WORKING = 0, FINISHED = 1;
  var status = READY;

  var startTime = 0;
  var curPos = 0;  //在本套题中目前题目的pos，非该套题的pos

  //***以下定义及创建元素变量***//

  var lzone = document.getElementById("listZone");
  var pzone = document.getElementById("perfZone");

  var qzone = document.getElementById("questionZone");
  var azone = document.getElementById("ansZone");

  var ei = document.getElementById("extraInfo");

  var rzone = document.getElementById("resZone");

  var startBtn = document.getElementById("startBtn");
  var nextBtn = document.getElementById("nextBtn");
  var perfBtn = document.getElementById("perfBtn");
  var backBtn = document.getElementById("backBtn");
  var repeatBtn = document.getElementById("repeatBtn");

  var titleEl = document.getElementById("title");
  var perfEl = document.getElementById("perf");

  var items = [];

  for (let i = 0; i < titles.length; i++) {
    let item = document.createElement("li");
    item.setAttribute("key", i);
    item.innerHTML = titles[i];
    items.push(item);
    lzone.appendChild(item);
  }


  //***以下定义函数***//

  function startWork() {
    startTime = new Date().getTime();
    curPos = 0;

    status = WORKING;
    updateStatus();
  }

  function showWork() {
    ei.innerHTML = "第 " + (curPos + 1) + " 题";
    qzone.innerHTML = questions[curPos];
    azone.innerHTML = "点击看答案";
  }

  function moveNext() {
    curPos++;

    if (curPos == questions.length) {
      status = FINISHED;
      updateStatus();
    } else {
      showWork();
    }
  }

  function viewPerf() {
    let title = curTitle;
    titleEl.innerHTML = title;

    let recStr = localStorage.getItem(title);
    if (recStr) {
      rec = JSON.parse(recStr);
      perfEl.innerHTML = "";
      for (let k in rec) {
        perfEl.innerHTML += (k + "&nbsp;&nbsp;&nbsp;" + secsToMinSecs(parseInt(rec[k])) + "<BR />");
      }
    } else {
      perfEl.innerHTML = "无记录";
    }

    status = PERFINFO;
    updateStatus();
  }

  function secsToMinSecs(secs) {
    let minutes = Math.floor(secs / 60);
    let rv = minutes == 0 ? "" : (minutes + "分");
    let seconds = secs - minutes * 60;
    rv += (seconds == 0 ? "" : (seconds + "秒"));

    return rv;
  }

  function formatDate(fmt, date) {
    let ret;
    const opt = {
      "Y+": date.getFullYear().toString(),        // 年
      "m+": (date.getMonth() + 1).toString(),     // 月
      "d+": date.getDate().toString(),            // 日
      "H+": date.getHours().toString(),           // 时
      "M+": date.getMinutes().toString(),         // 分
      "S+": date.getSeconds().toString()          // 秒
      // 有其他格式化字符需求可以继续添加，必须转化成字符串
    };
    for (let k in opt) {
      ret = new RegExp("(" + k + ")").exec(fmt);
      if (ret) {
        fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")))
      };
    };
    return fmt;
  }

  function addRec(title, secs) {
    let recs = {};
    let recsStr = localStorage.getItem(title);
    if (recsStr) {
      recs = JSON.parse(recsStr);
    }

    recs[formatDate("YYYY-mm-dd HH:MM:SS", new Date())] = secs;

    localStorage.setItem(title, JSON.stringify(recs));
  }

  function showBtnsOnly() {
    let bvs = {
      "startBtn": false,
      "nextBtn": false,
      "perfBtn": false,
      "backBtn": false,
      "repeatBtn": false
    };

    for (let i = 0; i < arguments.length; i++) {
      bvs[arguments[i]] = true;
    }
    for (let b in bvs) {
      if (bvs[b]) {
        document.getElementById(b).style.display = "inline";
      } else {
        document.getElementById(b).style.display = "none";
      }
    }
  }

  function showBlocksOnly() {
    let bvs = {
      "listZone": false,
      "perfZone": false,
      "questionZone": false,
      "ansZone": false,
      "extraInfo": false,
      "resZone": false
    };

    for (let i = 0; i < arguments.length; i++) {
      bvs[arguments[i]] = true;
    }
    for (let b in bvs) {
      if (bvs[b]) {
        document.getElementById(b).style.display = "block";
      } else {
        document.getElementById(b).style.display = "none";
      }
    }
  }

  function updateStatus() {
    if (status == READY) {
      showBtnsOnly("startBtn", "perfBtn");
      showBlocksOnly("listZone");
    } else if (status == PERFINFO) {
      showBtnsOnly("backBtn");
      showBlocksOnly("perfZone");
    } else if (status == WORKING) {
      showBtnsOnly("nextBtn");
      showBlocksOnly("extraInfo", "ansZone", "questionZone");

      showWork();
    } else if (status == FINISHED) {
      showBtnsOnly("repeatBtn");
      showBlocksOnly("resZone");

      let usedTime = Math.round((new Date().getTime() - startTime) / 1000);
      rzone.innerHTML = secsToMinSecs(usedTime);
      addRec(curTitle, usedTime);
    }
  }

  function updateListView(spos) {
    for (let i = 0; i < items.length; i++) {
      if (items[i].getAttribute("key") == spos) {
        items[i].className = "selected";
      }
      else {
        items[i].className = "unselected";
      }
    }
  }

  for (let i = 0; i < items.length; i++) {
    items[i].onclick = function () {
      let k = this.getAttribute("key");
      updateListView(k);
      curTitle = this.innerHTML;
      questions = allData[parseInt(k)];
    }
  }

  function keyEvent(e) {
    let ev = e || window.event;  //标准化事件处理
    //处理回车键
    if (ev.keyCode == 13) {

      //必须，否则按钮获得焦点时，会触发其默认行为
      ev.preventDefault();
      ev.stopPropagation();

      if (status == READY) {
        startWork();
      } else {
        moveNext();
      }
    }

    //ev.returnValue = false;
  }

  //***以下绑定事件***//

  //如果写在keyup上，会触发body中元素的默认keypress行为
  document.body.onkeypress = keyEvent;

  startBtn.onclick = startWork;

  perfBtn.onclick = viewPerf;

  nextBtn.onclick = moveNext;

  backBtn.onclick = function () { status = READY; updateStatus(); }

  repeatBtn.onclick = function () { status = READY; updateStatus(); }

  azone.onclick = function () { this.innerHTML = "答案：" + eval(questions[curPos]); }


  //***以下初始化应用***//
  updateStatus();

  updateListView("0");

</script>

</html>